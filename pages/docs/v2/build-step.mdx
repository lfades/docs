import Doc from '~/components/layout/docs'
import { TerminalInput } from '~/components/text/terminal'
import { GenericLink } from '~/components/text/link'
import Caption from '~/components/text/caption'
import Now from '~/components/text/now'
import Note from '~/components/text/note'
import Card from '~/components/card'
import { InlineCode } from '~/components/text/code'
import { P } from '~/components/text/paragraph'

export const meta = {
  title: 'Build Step',
  description: 'Providing ZEIT Now with a build step.',
  editUrl: 'pages/docs/v2/build-step.mdx',
  lastEdited: '2019-07-19T20:05:56.000Z'
}

When you make a deployment with ZEIT Now, the first step is the build step. This means that Now recognizes a custom `build` script will be recognized by Now, with that build script outputting your app into the `public` directory.

You are also able to use [Environment Variables](#using-environment-variables-and-secrets) (including secrets) in your builds if you do not want to hardcode values for the build.

## Defining a Build Script

To build your project, Now looks for a `build` script inside of a `package.json` file. By providing a build script, Now will build your project from fresh on every deployment.

For example, to build Next.js fresh, each time you deploy, the following `build` script should be placed in the `package.json`:

```json
{
  ...
  "scripts": {
    "build": "next build"
  }
}
```

<Caption>
  An example <InlineCode>package.json</InlineCode> file with a{' '}
  <InlineCode>build</InlineCode> script that builds Next.js on each deploy.
</Caption>

## Using Environment Variables and Secrets

### Adding Secrets

To define an environment variable, you should use **Now Secrets**. By using **Now Secrets**, the data will be encrypted and stored securely, no longer directly accessible by anyone, and only exposed to deployments as environment variables.

Adding **Now Secrets** can be done with [Now ClI](/now), providing three options to work with them.

To **define a Now Secret**, use the following command:

<TerminalInput><P.B>now secrets add </P.B>secret-name secret-value</TerminalInput>
<Caption>Defining a <P.B>Now Secret</P.B> using <GenericLink href="/now">Now CLI</GenericLink>.</Caption>

To **remove a Now Secret**, use the following command:

<TerminalInput><P.B>now secrets rm </P.B>secret-name</TerminalInput>
<Caption>Removing a <P.B>Now Secret</P.B> using <GenericLink href="/now">Now CLI</GenericLink>.</Caption>

To **rename a Now Secret**, use the following command:

<TerminalInput><P.B>now secrets rename </P.B>secret-name new-name</TerminalInput>
<Caption>Renaming a <P.B>Now Secret</P.B> using <GenericLink href="/now">Now CLI</GenericLink>.</Caption>

### Providing Environment Variables

To provide your project with environment variables during the build script, you should create a `now.json` file like the one below:

```json
{
  "build": {
    "env": {
      "VARIABLE_NAME": "@secret-name"
    }
  }
}
```

<Caption>
  An example <InlineCode>now.json</InlineCode> file that provides an
  application's build step with a defined environment variable.
</Caption>

To use the environment variable from inside the application you would need to reference it using the correct syntax for the language being used. For example, using Node.js, the syntax would be:

```
process.env.VARIABLE_NAME
```

<Caption>
  Accessing a defined environment variable from within a Node.js application.
</Caption>

Now, whenever the `process.env.VARIABLE_NAME` key is used, it will provide the application's build step with the value declared by the referenced **Now Secret**.

## Related

For more information on what to do next, we recommend the following articles:

<Card title="Git Integration" href="/docs/v2/git-integration">
  Learn more about how ZEIT Now integrates with Git to make your workflow
  easier.
</Card>

<Card title="Custom Domains" href="/docs/v2/custom-domains">
  Once deployed, your projects can be aliased to a custom domain or specified
  name of your choice to give it a primary place for people to see the latest
  version of your application.
</Card>

export default ({ children }) => <Doc meta={meta}>{children}</Doc>
